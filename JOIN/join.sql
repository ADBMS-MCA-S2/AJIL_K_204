CREATE DATABASE MovieDatabase;
USE MovieDatabase;

CREATE TABLE ACTOR(Act_id INT PRIMARY KEY NOT NULL, Act_Name VARCHAR(30) NOT NULL, Act_Gender ENUM('MALE','FEMALE'));
INSERT INTO ACTOR VALUES(111,"MOHANLAL","MALE");
INSERT INTO ACTOR VALUES(112,"DILEEP","MALE");
INSERT INTO ACTOR VALUES(113,"SURYA","MALE");
INSERT INTO ACTOR VALUES(114,"VIJAY","MALE");
INSERT INTO ACTOR VALUES(115,"PRABHAS","MALE");
SELECT * FROM  ACTOR;

CREATE TABLE DIRECTOR (Dir_id INT PRIMARY KEY NOT NULL, Dir_Name VARCHAR(30) NOT NULL, Dir_Phone BIGINT(20));
INSERT INTO DIRECTOR VALUES(500,"HITCHCOCK",9876543210);
INSERT INTO DIRECTOR VALUES(601,"Steven Spielberg",9876543765);
INSERT INTO DIRECTOR VALUES(654,"LAL JOSE",7665437650);
INSERT INTO DIRECTOR VALUES(800,"SHANKAR",6786543765);
SELECT * FROM  DIRECTOR;

CREATE TABLE MOVIES (Mov_id INT PRIMARY KEY NOT NULL, Mov_Title VARCHAR(30) PRIMARY KEY NOT NULL, Mov_Year YEAR NOT NULL, Mov_Lang  VARCHAR(30) NOT NULL,Dir_id INT NOT NULL);
INSERT INTO MOVIES VALUES(200,"PYSCHO",1960,"ENGLISH",500);
INSERT INTO MOVIES VALUES(202,"ROPE",1948,"ENGLISH",500);
INSERT INTO MOVIES VALUES(276,"READY PLAYER ONE",2018,"ENGLISH",601);
INSERT INTO MOVIES VALUES(296,"LINCOLN",2012,"ENGLISH",601);
INSERT INTO MOVIES VALUES(236,"MASTER",2021,"TAMIL",800);
SELECT * FROM  MOVIES;

CREATE TABLE MOVIE_CAST (Act_id INT PRIMARY KEY NOT NULL, Mov_id INT NOT NULL, Role VARCHAR(30) NOT NULL);
INSERT INTO MOVIE_CAST VALUES(113,276,"HERO");
INSERT INTO MOVIE_CAST VALUES(111,296,"HERO");
INSERT INTO MOVIE_CAST VALUES(114,236,"HERO");
INSERT INTO MOVIE_CAST VALUES(112,296,"CO-ACTOR");
INSERT INTO MOVIE_CAST VALUES(115,200,"HERO");
SELECT * FROM  MOVIE_CAST;

CREATE TABLE RATING (Mov_id INT PRIMARY KEY NOT NULL, Rev_Stars FLOAT(0) NOT NULL);
INSERT INTO RATING  VALUES(200,4.5);
INSERT INTO RATING  VALUES(202,5);
INSERT INTO RATING  VALUES(276,3.5);
INSERT INTO RATING  VALUES(296,3.5);
INSERT INTO RATING  VALUES(236,3);
SELECT * FROM  RATING;

SELECT Mov_Title FROM MOVIES INNER JOIN DIRECTOR WHERE MOVIES.Dir_id=DIRECTOR.Dir_id AND Dir_Name="HITCHCOCK";

SELECT Mov_title FROM MOVIES WHERE Mov_id IN (SELECT Mov_id FROM MOVIE_CAST WHERE Act_id IN (SELECT Act_id FROM actor WHERE Act_id IN (SELECT Act_id FROM MOVIE_CAST GROUP BY Act_id HAVING COUNT(Act_id)>1)));

SELECT Distinct Act_Name FROM ACTOR INNER JOIN MOVIE_CAST ON ACTOR.Act_id=MOVIE_CAST.Act_id JOIN MOVIES ON MOVIE_CAST.Mov_id=MOVIES.Mov_id WHERE MOVIES.Mov_Year<2000 OR MOVIES.Mov_Year>2015 AND MOVIES.Mov_id=MOVIE_CAST.Mov_id and ACTOR.Act_id=MOVIE_CAST.Act_id; 
    
SELECT mov_title,MAX(rev_stars) FROM movies INNER JOIN rating USING (mov_id) GROUP BY mov_title HAVING MAX(rev_stars)>0 ORDER BY mov_title;

SET SQL_SAFE_UPDATES=0;
UPDATE rating SET rev_stars=5 WHERE mov_id IN (SELECT mov_id FROM movies WHERE dir_id IN (SELECT dir_id FROM director WHERE dir_name='steven spielberg'));
